#!/bin/bash

# Функция для проверки исполняемых файлов в директории
check_directory() {
    local dir="$1"
    # Проверяем, является ли это директорией
    if [[ -d "$dir" ]]; then
        # Проверяем наличие исполняемых файлов
        for file in "$dir/"*; do
            if [[ -x "$file" ]]; then
                return 0  # Найден хотя бы один исполняемый файл
            fi
        done
    fi
    return 1  # Исполняемые файлы не найдены или директория не существует
}

# Основная логика скрипта
if [[ "$1" == "-h" || "$1" == "--help" ]]; then  # Проверяем параметры на наличие справки
    echo "Использование $0 [DIRECTORY]"
    echo "Проверка исполняемых файлов в директории, указанных в PATH или в данной директории."
    exit 0  
fi

# Если параметр не передан, используем переменную PATH
if [[ -z "$1" ]]; then
    paths=$(echo "$PATH" | tr ':' ' ')  # Заменяем ':' на пробел для удобства обработки
else
    paths="$1"  # Используем переданный параметр как список директорий
fi

# Удаляем дубликаты и формируем массив уникальных директорий
IFS=' ' read -r -a unique_dirs <<< "$(echo "$paths" | tr ' ' 'n' | sort -u | tr 'n' ' ')"

# Переменная для хранения очищенного PATH
cleaned_path=""

# Проверяем каждую директорию на наличие исполняемых файлов
for dir in "${unique_dirs[@]}"; do  # Проходим по уникальным директориям
    if check_directory "$dir"; then  # Проверяем текущую директорию
        cleaned_path+="$dir:"  # Если директория правильная, добавляем её в cleaned_path
    fi
done

# Удаляем последний символ ":" из cleaned_path, если он есть
cleaned_path=${cleaned_path%:}

# Выводим очищенный PATH
echo "$cleaned_path"


