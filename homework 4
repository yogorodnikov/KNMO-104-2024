#!/bin/bash 
# Проверка входных параметров 
if [[ $1 == "-h" || $1 == "--help" ]]; then 
    echo "Использование: $0 <logs.log>" 
    exit 0 
fi 
if [ -z "$1" ]; then 
    echo "Ошибка: Не указано имя файла с логами." 
    exit 1 
fi 
# Убедимся, что файл существует 
if [ ! -f "$log_file" ]; then 
    echo "Ошибка: Файл '$log_file' не найден." 
    exit 1 
fi 
log_file="$1" 
output_file="filtered_logs.txt"
# Извлекаем ресурсы и считаем их частоту использования
resources=$(awk -F '|' '{print $4}' "$log_file" | sort | uniq -c | sort -nr | head -n 3 | awk '{print $2}')
# Проверяем, найдены ли ресурсы
if [ -z "$resources" ]; then
    echo "Нет популярных ресурсов для фильтрации."
    exit 0
fi
# Создаем выходной файл с записями для популярных ресурсов 
echo "Фильтрация логов" 
# Используем grep с фиксированными строками для повышения производительности
grep -E "$(echo "$resources" | tr '\n' '|' | sed 's/^/|/;s/$/|/')" "$log_file" | 
sort -t '|' -k5,5n -k4,4 > "$output_file"
echo "Фильтрация завершена. Результаты записаны в '$output_file'."


