#!/bin/bash

# Функция для проверки, содержит ли директория исполняемые файлы
check_directory() {
    local dir="\$1"
    # Проверяем, существует ли директория и является ли она директорией
    if [[ -d "$dir" ]]; then
        # Ищем исполняемые файлы в директории
        for file in "$dir"/*; do
            # Проверяем, существует ли файл и является ли он исполняемым
            if [[ -e "$file" && -x "$file" ]]; then
                return 0  # Найден исполняемый файл
            fi
        done
    fi
    return 1  # Исполняемые файлы не найдены или директория не существует
}

# Основная логика скрипта
if [[ "\$1" != "-h" && "\$1" != "--help" ]]; then
    input_paths="\$1"  # Используем переданный аргумент, если это не помощь
else
    input_paths="$PATH"  # По умолчанию используем PATH
fi

# Объявляем ассоциативный массив для обработки дубликатов
declare -A unique_paths
cleaned_paths=()

# Разбиваем входные пути по двоеточию и проверяем каждый из них
IFS=':' read -ra dirs <<< "$input_paths"
for dir in "${dirs[@]}"; do
    # Проверяем, есть ли исполняемые файлы в директории
    if check_directory "$dir"; then
        # Добавляем только уникальные директории
        unique_paths["$dir"]=1
    fi
done

# Собираем уникальные валидные пути
for valid_dir in "${!unique_paths[@]}"; do
    cleaned_paths+=("$valid_dir")
done

# Выводим очищенный PATH
echo "${cleaned_paths[*]}" | tr ' ' ':'
